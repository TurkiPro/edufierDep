<%- include('../../header.ejs') -%>
<body>
    <div class="container-fluid">
        <div class="row">
            <%- include('../../nav.ejs') -%>
            <div class="col-sm p-3 min-vh-100">
                <div class="container list">
                    <% courses.lessons.forEach(function(lesson, i){ %>
                        <div class="row mt-3">
                            <div class="col-4">
                                <a href="/lessons/lesson/<%= lesson.id %>">
                                    <h3><%= lesson.name %> </h3>
                                    <h4><%= lesson.data %> </h4>
                                </a>
                            </div>
                            <div class="col-2 bg-secondary">
                                <a href="/quizzes/lesson/<%= lesson.id %>/quiz/new" target="_blank">add a quiz</a>
                            </div>
                            <div class="col-2 bg-secondary">
                                <a href="/lessons/lesson/<%= lesson.id %>/quizzes/" target="_blank">all lesson quizzes</a>
                            </div>
                            <div class="col-2 bg-info text-white">
                                <a href="" target="_blank">edit</a>
                            </div>
                            <div class="col-2 bg-danger text-white">
                                <a onclick="deleteWindow(this)" data-id="<%= lesson.id %>">delete</a>
                            </div>
                        </div>
                    <% }); %>
                    <!-- <div class="row mt-5">
                        <div class="d-flex justify-content-center">
                            <a href="/posts/new" class="d-flex align-items-center justify-content-between"> <span>Ask Something</span>  <i class="bi bi-telegram"></i></a>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
        <div class="modal" tabindex="-1" id="myModal">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Delete Confirmation</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p>Are you sure you want to delete this quiz?</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-danger" id="deleteBtn">Delete</button>
                </div>
              </div>
            </div>
          </div>
    </div>
    <!-- bootstrap script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <script>

        let myModal = new bootstrap.Modal(document.getElementById('myModal'), {});

        function deleteWindow(element){
            let deleBtn = document.getElementById('deleteBtn');
            deleBtn.setAttribute("data-delete", element.dataset.id)
            myModal.show();
            console.log(element.dataset.id)
        }

    </script>
    <script>
        
        window.onload=function() {
        const eform = document.querySelector('#deleteBtn');
        eform.addEventListener('click', async event =>{
            event.preventDefault();


            try{
                const res = await fetch('/lessons/lesson/'+eform.dataset.delete, {
                method: 'DELETE',
                credentials: "include",
                headers: {
                    'Content-Type': 'application/json'
                }

            }) 
                const resData = await res.json()
                console.log(resData)
                location.reload() 
            } catch (err) {
                console.log(err.message)
            }
        })
    }
    </script>
</body>
</html>